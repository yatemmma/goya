<html>
<head>
	<meta charset="UTF-8" content="text/html" http-equiv="Content-Type">
	<title>I'm not a dish!</title>
	<script src="http://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
  <script src="websocket.js"></script>
</head>
<body>
<input type="button" value="open game window" onClick="openGameWindow();" />
<input type="button" class="command-button" value="back_to_port" />
<input type="button" class="command-button" value="quest_list" />
<input type="button" class="command-button" value="quest_list/402/403/410" />
<input type="button" class="command-button" value="mission_result/2:3/3:5/4:9" />
<input type="button" class="command-button" value="charge/2/3/4" />
<input type="button" class="command-button" value="mission_start/2:3/3:5/4:9" />
<input type="button" class="command-button" value="cancel" />
<input type="button" class="command-button" value="cursor" />
<input type="button" class="command-button" value="_mission_loop" />
<input type="button" class="command-button" value="_mission_loop_stop" />

<div>
  <input id="command" size="40" type="text" value="back_to_port">
  <input id="send" type="button" value="send">
</div>
<ul id="chat"></ul>

<script>
function openGameWindow() {
  window.open('game.html', 'game_window', "left="+0+",top="+0+",width="+798+",height="+478);
}

$(".command-button").click(function() {
	var msg = $(this).val();
	if (msg.substring(0,1) == "_") {
    eval(msg)();
  } else {
    $("#command").val(msg);
    post();
  }
})

function _mission_loop() {
	$("#command").val("quest_list/402/403/410"); // mission ids
	post();

	var min = Math.floor(Math.random() * 20) + 10;
  missionTimer = setTimeout("_mission_loop()", 1000 * 60 * min);

  var date = new Date();
  var h = date.getHours();
  var m = date.getMinutes();
  var s = date.getSeconds();
  console.log(h + ":" + m + ":" + s + " next mission check: " + min);

  document.title = document.title.replace(/( \([0-9]*\)$)/, "");
  document.title += " ("+min+")";
}

function _mission_loop_stop() {
  console.log("mission timer stopped: " + missionTimer);
  clearTimeout(missionTimer);
  missionTimer = null;

  document.title = document.title.replace(/( \([0-9]*\)$)/, "");
}

</script>
</body>
</html>
